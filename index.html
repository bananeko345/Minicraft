<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>AIクラフト 完全版サンプル</title>
  <style>
    body, html { margin:0; padding:0; height:100%; overflow:hidden; }
    canvas { display:block; }
    #ui {
      position:absolute; top:0; left:0; width:100%; height:100%;
      display:flex; justify-content:center; align-items:center;
      background:rgba(0,0,0,0.7); color:#fff; font-family:sans-serif;
    }
    #hud {
      position:absolute; top:0; left:0; width:100%; height:100%;
      pointer-events:none; color:#fff; font-family:sans-serif;
    }
    #coords { position:absolute; top:10px; right:10px; }
    #chat { position:absolute; top:10px; left:10px; width:300px; height:150px; background:rgba(0,0,0,0.5); overflow-y:auto; }
    #chatInput { position:absolute; bottom:10px; left:10px; width:300px; }
    .touchControls { position:absolute; bottom:20px; width:100%; display:flex; justify-content:center; }
    .touchButton { margin:5px; padding:10px; background:#333; color:#fff; border-radius:5px; }
  </style>
</head>
<body>
  <!-- 起動画面 -->
  <div id="ui">
    <div>
      <h1>AIクラフト</h1>
      <label>名前: <input id="playerName" type="text" placeholder="プレイヤー名"></label><br><br>
      <label>スキン:
        <select id="skinSelect">
          <option value="default">デフォルト</option>
          <option value="red">赤</option>
          <option value="blue">青</option>
        </select>
      </label><br><br>
      <label>デバイス:
        <select id="deviceSelect">
          <option value="pc">PC</option>
          <option value="tablet">タブレット</option>
        </select>
      </label><br><br>
      <button onclick="startGame()">ゲーム開始</button>
    </div>
  </div>

  <!-- HUD -->
  <div id="hud" style="display:none;">
    <div id="coords">X:0 Y:0 Z:0</div>
    <div id="chat"></div>
    <input id="chatInput" placeholder="チャット入力">
    <div id="tabletControls" class="touchControls" style="display:none;">
      <button class="touchButton" onclick="jump()">ジャンプ</button>
      <button class="touchButton" onclick="openInventory()">インベントリ</button>
      <button class="touchButton" onclick="switchItem()">アイテム切替</button>
    </div>
  </div>

  <canvas id="gameCanvas"></canvas>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
  <script>
    let scene, camera, renderer, device;
    let clock = new THREE.Clock();
    let dayTime = 0;

    // ブロック定義（増やせる仕組み）
    const blocks = {
      grass: { color:0x228B22 },
      sand: { color:0xC2B280 },
      water: { color:0x1E90FF },
      stone: { color:0x808080 },
      wood: { color:0x8B4513 }
    };

    // モブ定義（サンプル）
    const mobs = [
      { name:"村人", color:0xFFD700 },
      { name:"敵", color:0xFF0000 }
    ];

    function startGame() {
      device = document.getElementById("deviceSelect").value;
      document.getElementById("ui").style.display = "none";
      document.getElementById("hud").style.display = "block";
      if(device === "tablet") {
        document.getElementById("tabletControls").style.display = "flex";
      }
      initGame();
      animate();
    }

    function initGame() {
      scene = new THREE.Scene();
      camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 1000);
      renderer = new THREE.WebGLRenderer({canvas:document.getElementById("gameCanvas")});
      renderer.setSize(window.innerWidth, window.innerHeight);

      // マップ生成（森＋砂漠）
      generateBiome("forest", -20, 0);
      generateBiome("desert", 20, 0);

      // モブ追加
      mobs.forEach((mob,i)=>{
        let geo = new THREE.BoxGeometry(1,2,1);
        let mat = new THREE.MeshBasicMaterial({color:mob.color});
        let mesh = new THREE.Mesh(geo,mat);
        mesh.position.set(i*3,1,5);
        scene.add(mesh);
      });

      camera.position.set(0,5,15);
    }

    function generateBiome(type, offsetX, offsetZ){
      for(let x=0;x<10;x++){
        for(let z=0;z<10;z++){
          let blockType = (type==="forest") ? "grass" : "sand";
          let geo = new THREE.BoxGeometry(1,1,1);
          let mat = new THREE.MeshBasicMaterial({color:blocks[blockType].color});
          let cube = new THREE.Mesh(geo,mat);
          cube.position.set(offsetX+x,0,offsetZ+z);
          scene.add(cube);
        }
      }
    }

    function animate() {
      requestAnimationFrame(animate);
      dayTime += clock.getDelta();
      let skyColor = dayTime % 20 < 10 ? 0x87CEEB : 0x000022;
      renderer.setClearColor(skyColor);
      renderer.render(scene, camera);
      document.getElementById("coords").innerText = `X:${camera.position.x.toFixed(1)} Y:${camera.position.y.toFixed(1)} Z:${camera.position.z.toFixed(1)}`;
    }

    // 操作系
    function jump(){ camera.position.y += 1; }
    function openInventory(){ alert("インベントリ開く"); }
    function switchItem(){ alert("アイテム切替"); }
  </script>
</body>
</html>
